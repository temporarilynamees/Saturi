# ì‚¬íˆ¬ë¦¬ ë²ˆì—­ê¸° Backend

Node.jsì™€ Expressë¥¼ ì‚¬ìš©í•œ í•œêµ­ì–´ ì‚¬íˆ¬ë¦¬ ë²ˆì—­ ë° ìŒì„± ì¸ì‹ API ì„œë²„ì…ë‹ˆë‹¤.

## ê¸°ëŠ¥

- ğŸ”„ **ì‚¬íˆ¬ë¦¬ ë²ˆì—­**: ì œì£¼ ì‚¬íˆ¬ë¦¬ â†” í‘œì¤€ì–´ ì–‘ë°©í–¥ ë²ˆì—­
- ğŸ¤ **ìŒì„± ì¸ì‹ (STT)**: ETRI APIë¥¼ í™œìš©í•œ í•œêµ­ì–´ ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜
- ğŸµ **ì˜¤ë””ì˜¤ ì²˜ë¦¬**: WebM â†’ WAV ìë™ ë³€í™˜ (FFmpeg)
- ğŸŒ **CORS ì§€ì›**: í”„ë¡ íŠ¸ì—”ë“œ í†µí•©
- ğŸ“ **íŒŒì¼ ì—…ë¡œë“œ**: Multer ê¸°ë°˜ ì˜¤ë””ì˜¤ íŒŒì¼ ì²˜ë¦¬

## ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. ì˜ì¡´ì„± ì„¤ì¹˜
```bash
npm install
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
`.env` íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•©ë‹ˆë‹¤:

### 3. ê°œë°œ ì„œë²„ ì‹¤í–‰
```bash
npm run dev
```

ì„œë²„ëŠ” `http://localhost:3000`ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

### 4. í”„ë¡œë•ì…˜ ì‹¤í–‰
```bash
npm start
```

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ translation/
â”‚   â”‚   â”‚   â”œâ”€â”€ translation.router.js       # ë²ˆì—­ ë¼ìš°íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ translation.controller.js   # ë²ˆì—­ ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â”‚   â”‚   â””â”€â”€ translation.service.js      # ë²ˆì—­ ì„œë¹„ìŠ¤ (ì œì£¼ ì‚¬íˆ¬ë¦¬ ì‚¬ì „)
â”‚   â”‚   â”œâ”€â”€ stt/
â”‚   â”‚   â”‚   â”œâ”€â”€ stt.router.js              # STT ë¼ìš°íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ stt.controller.js          # STT ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â”‚   â”‚   â””â”€â”€ stt.service.js             # ETRI API ì—°ë™ & FFmpeg ë³€í™˜
â”‚   â”‚   â””â”€â”€ tts/                           # (ì˜ˆì •)
â”‚   â”œâ”€â”€ uploads/                           # ì„ì‹œ ì˜¤ë””ì˜¤ íŒŒì¼ ì €ì¥ì†Œ
â”‚   â”œâ”€â”€ app.js                             # Express ì•± ì„¤ì •
â”‚   â””â”€â”€ server.js                          # ì„œë²„ ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸
â”œâ”€â”€ .env                                   # í™˜ê²½ ë³€ìˆ˜ (git ignore)
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## API ì—”ë“œí¬ì¸íŠ¸

### 1. ë²ˆì—­ API

**ì—”ë“œí¬ì¸íŠ¸:** `POST /api/translation`

**ìš”ì²­ ë³¸ë¬¸:**
```json
{
  "sentence": "ì•ˆë‡½í•˜ì‹œê²Œ ì–´ë””ê°€ê²Œ",
  "direction": "jeju to korean"
}
```

**direction ì˜µì…˜:**
- `"jeju to korean"`: ì œì£¼ ì‚¬íˆ¬ë¦¬ â†’ í‘œì¤€ì–´ (ê¸°ë³¸ê°’)
- `"korean to jeju"`: í‘œì¤€ì–´ â†’ ì œì£¼ ì‚¬íˆ¬ë¦¬

**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "translation": "ì•ˆë…•í•˜ì„¸ìš” ì–´ë”” ê°€ì„¸ìš”"
}
```

**ì§€ì› ì œì£¼ ì‚¬íˆ¬ë¦¬ ì˜ˆì‹œ:**
- ì¸ì‚¬: `ì•ˆë‡½í•˜ì‹œê²Œ`, `í˜¼ì €ì˜µì„œì˜ˆ`, `ì•ˆë‡½íˆê²Œì‹œì„œ`
- ì¼ìƒ: `í–ˆìˆ˜ê¹¡`, `ê³±ë‹¤`, `ì´ë…`, `ì–´ë©`, `ì•„ë°©`
- ë™ì‚¬: `ê°€ê²Œ`, `ì™”ìˆ˜ê²Œ`, `ë¨¹ì—‰`, `ë³´ë¼ê²Œ`
- ê¸°íƒ€: `ì˜¤ë¦„`, `ì˜¬ë ˆ`, `ë‹¥ì„¸`, `ë¬´ì‚¬`, `ì§€ìŠ¥`

**ì—ëŸ¬ ì‘ë‹µ:**
```json
{
  "message": "ë¬¸ì¥ì´ í•„ìš”í•©ë‹ˆë‹¤."
}
```

### 2. ìŒì„± ì¸ì‹ (STT) API

**ì—”ë“œí¬ì¸íŠ¸:** `POST /api/stt`

**ìš”ì²­ í˜•ì‹:** `multipart/form-data`

**íŒŒë¼ë¯¸í„°:**
- `audio`: ì˜¤ë””ì˜¤ íŒŒì¼ (WAV, WebM ì§€ì›)

**cURL ì˜ˆì‹œ:**
```bash
curl -X POST http://localhost:3000/api/stt \
  -F "audio=@recording.wav"
```

**ì‘ë‹µ ì˜ˆì‹œ (ETRI API í˜•ì‹):**
```json
{
  "return_object": {
    "recognized": "ì•ˆë…•í•˜ì„¸ìš”"
  }
}
```

**ì²˜ë¦¬ ê³¼ì •:**
1. ì˜¤ë””ì˜¤ íŒŒì¼ ì—…ë¡œë“œ â†’ `src/uploads/` ì„ì‹œ ì €ì¥
2. WebM í˜•ì‹ì¼ ê²½ìš° â†’ WAV ìë™ ë³€í™˜ (FFmpeg)
3. WAV íŒŒì¼ â†’ Base64 ì¸ì½”ë”©
4. ETRI API í˜¸ì¶œ (í•œêµ­ì–´ ìŒì„± ì¸ì‹)
5. ê²°ê³¼ ë°˜í™˜ í›„ ì„ì‹œ íŒŒì¼ ìë™ ì‚­ì œ

**ì—ëŸ¬ ì‘ë‹µ:**
```json
{
  "error": "ì˜¤ë””ì˜¤ íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤."
}
```

## ì‚¬ìš© ê¸°ìˆ 

### Backend Framework
- **Node.js** - JavaScript ëŸ°íƒ€ì„
- **Express 5** - ì›¹ í”„ë ˆì„ì›Œí¬
- **CORS** - Cross-Origin Resource Sharing
- **dotenv** - í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

### ìŒì„± ì²˜ë¦¬
- **FFmpeg** - ì˜¤ë””ì˜¤ í¬ë§· ë³€í™˜ (WebM â†’ WAV)
- **fluent-ffmpeg** - FFmpeg Node.js ë˜í¼
- **@ffmpeg-installer/ffmpeg** - FFmpeg ìë™ ì„¤ì¹˜

### íŒŒì¼ ì—…ë¡œë“œ
- **Multer** - multipart/form-data ì²˜ë¦¬
- ì—…ë¡œë“œ ê²½ë¡œ: `src/uploads/`
- ìë™ íŒŒì¼ëª…: `audio-{timestamp}-{random}.wav`

### ì™¸ë¶€ API
- **ETRI WiseASR** - í•œêµ­ì–´ ìŒì„± ì¸ì‹
- **Axios** - HTTP í´ë¼ì´ì–¸íŠ¸

## ì£¼ìš” ë¯¸ë“¤ì›¨ì–´

- `express.json()` - JSON ìš”ì²­ ë³¸ë¬¸ íŒŒì‹±
- `cors()` - CORS í™œì„±í™” (ëª¨ë“  ë„ë©”ì¸ í—ˆìš©)
- `express.static()` - ì •ì  íŒŒì¼ ì„œë¹™
- `multer()` - íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬

## ì—ëŸ¬ ì²˜ë¦¬

ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ëŠ” ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œì™€ í•¨ê»˜ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤.

```javascript
try {
  // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
} catch (error) {
  res.status(500).json({ error: error.message });
}
```

**ì¼ë°˜ì ì¸ ì—ëŸ¬ ìƒí™©:**
- `400 Bad Request`: í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½
- `500 Internal Server Error`: ETRI API í˜¸ì¶œ ì‹¤íŒ¨, FFmpeg ë³€í™˜ ì‹¤íŒ¨

## ê°œë°œ ê°€ì´ë“œ

### MVC ì•„í‚¤í…ì²˜
- **Router**: HTTP ìš”ì²­ ë¼ìš°íŒ… ë° ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- **Controller**: ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬, ìœ íš¨ì„± ê²€ì¦, ì—ëŸ¬ í•¸ë“¤ë§
- **Service**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ (ë²ˆì—­, API í˜¸ì¶œ, íŒŒì¼ ë³€í™˜)

### ìƒˆë¡œìš´ API ì¶”ê°€í•˜ê¸°
1. `src/api/` ì— ìƒˆ í´ë” ìƒì„± (ì˜ˆ: `tts/`)
2. ë‹¤ìŒ íŒŒì¼ë“¤ ìƒì„±:
   - `{name}.router.js` - ë¼ìš°íŠ¸ ì •ì˜
   - `{name}.controller.js` - ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬
   - `{name}.service.js` - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
3. [src/app.js](src/app.js)ì— ë¼ìš°í„° ë“±ë¡:

```javascript
const newApi = require('./api/your-endpoint/your-endpoint.router');
app.use('/api/your-endpoint', newApi);
```

### ë²ˆì—­ ì‚¬ì „ ì¶”ê°€í•˜ê¸°

[src/api/translation/translation.service.js](src/api/translation/translation.service.js)ì˜ `dialectDictionary` ê°ì²´ì— ìƒˆ íŒ¨í„´ ì¶”ê°€:

```javascript
const dialectDictionary = {
    jeju: {
        patterns: [
            {dialect: "ì‚¬íˆ¬ë¦¬ë‹¨ì–´", standard: "í‘œì¤€ì–´ë‹¨ì–´"},
            // ìƒˆ íŒ¨í„´ ì¶”ê°€
        ]
    },
    // ë‹¤ë¥¸ ì§€ì—­ ì‚¬íˆ¬ë¦¬ ì¶”ê°€ ê°€ëŠ¥ (ë¶€ì‚°, ê²½ìƒë„ ë“±)
}
```

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### FFmpeg ì„¤ì¹˜ ì˜¤ë¥˜
```bash
# FFmpeg ìˆ˜ë™ ì„¤ì¹˜ (Linux)
sudo apt-get install ffmpeg

# macOS
brew install ffmpeg
```

### ETRI API ì—ëŸ¬
- API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- ì¼ì¼ í˜¸ì¶œ í•œë„ í™•ì¸ (ë¬´ë£Œ í”Œëœ: 1,000ê±´/ì¼)
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸

### íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨
- `src/uploads/` ë””ë ‰í† ë¦¬ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
- íŒŒì¼ ê¶Œí•œ í™•ì¸ (`chmod 755 src/uploads/`)

### í¬íŠ¸ ì¶©ëŒ
```bash
# í¬íŠ¸ ì‚¬ìš© í™•ì¸
lsof -i :3000

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
kill -9 <PID>
```

## ë¼ì´ì„ ìŠ¤

ISC

## ê°œë°œì

- GitHub: [temporarilynamees/Saturi](https://github.com/temporarilynamees/Saturi)
